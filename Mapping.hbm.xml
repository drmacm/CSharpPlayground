<?xml version="1.0" encoding="utf-8"?>
<!--Generated from NHibernate.Mapping.Attributes on 2017-01-08 09:00:05Z.-->
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2">
  <class lazy="false" table="AUDIT_LOG_RECORD" name="NHibernateInAction.CaveatEmptor.Persistence.Audit.AuditLogRecord, NHibernateInAction.CaveatEmptor">
    <id name="Id" access="field" type="long">
      <generator class="native" />
    </id>
    <property name="Message" access="field" />
    <property name="EntityId" access="field" />
    <property name="EntityType" access="field" />
    <property name="UserId" access="field" />
    <property name="Created" access="field" />
    <property name="EntityClass" access="field" />
  </class>
  <class table="BID" name="NHibernateInAction.CaveatEmptor.Model.Bid, NHibernateInAction.CaveatEmptor">
    <id name="Id" column="BID_ID">
      <generator class="native" />
    </id>
    <version name="Version" column="VERSION" />
    <property name="Amount" type="NHibernateInAction.CaveatEmptor.Persistence.MonetaryAmountCompositeUserType, NHibernateInAction.CaveatEmptor" update="false">
      <column name="INITIAL_PRICE" length="2" not-null="true" />
      <column name="INITIAL_PRICE_CURRENCY" not-null="true" />
    </property>
    <property name="Created" column="CREATED" not-null="true" update="false" />
    <many-to-one name="Item" column="ITEM_ID" not-null="true" outer-join="false" update="false" />
    <many-to-one name="Bidder" column="BIDDER_ID" not-null="true" outer-join="true" update="false" />
  </class>
  <class table="BILLING_DETAILS" name="NHibernateInAction.CaveatEmptor.Model.BillingDetails, NHibernateInAction.CaveatEmptor">
    <id name="Id" column="BILLING_DETAILS_ID">
      <generator class="native" />
    </id>
    <version name="Version" column="VERSION" />
    <property name="OwnerName" column="OWNER_NAME" not-null="true" />
    <property name="Created" column="CREATED" not-null="true" update="false" />
    <many-to-one name="User" column="USER_ID" outer-join="false" update="false" />
  </class>
  <class lazy="true" table="CATEGORIZED_ITEM" name="NHibernateInAction.CaveatEmptor.Model.CategorizedItem, NHibernateInAction.CaveatEmptor">
    <composite-id name="Id" unsaved-value="any">
      <key-property name="categoryId" access="field" />
      <key-property name="itemId" access="field" />
    </composite-id>
    <property name="Username" column="USERNAME" not-null="true" update="false" />
    <property name="DateAdded" column="DATE_ADDED" not-null="true" update="false" />
    <many-to-one name="Category" column="CATEGORY_ID" not-null="true" update="false" />
    <many-to-one name="Item" column="ITEM_ID" not-null="true" update="false" />
  </class>
  <class table="CATEGORY" name="NHibernateInAction.CaveatEmptor.Model.Category, NHibernateInAction.CaveatEmptor">
    <id name="Id" column="CATEGORY_ID">
      <generator class="native" />
    </id>
    <property name="Name">
      <column name="NAME" length="255" not-null="true" unique-key="UNIQUE_NAME_AT_LEVEL" />
    </property>
    <property name="Created" column="CREATED" not-null="true" update="false" />
    <many-to-one name="ParentCategory" outer-join="false" foreign-key="FK1_PARENT_CATEGORY_ID">
      <column name="PARENT_CATEGORY_ID" not-null="false" />
    </many-to-one>
    <set name="ChildCategories" inverse="true" cascade="all-delete-orphan" batch-size="10">
      <key column="PARENT_CATEGORY_ID" />
      <one-to-many class="NHibernateInAction.CaveatEmptor.Model.Category, NHibernateInAction.CaveatEmptor" />
    </set>
    <set name="CategorizedItems" inverse="true" cascade="all-delete-orphan" outer-join="false">
      <key foreign-key="FK1_CATEGORIZED_ITEM_ID">
        <column name="CATEGORY_ID" length="16" not-null="true" />
      </key>
      <one-to-many class="NHibernateInAction.CaveatEmptor.Model.CategorizedItem, NHibernateInAction.CaveatEmptor" />
    </set>
  </class>
  <class table="COMMENTS" name="NHibernateInAction.CaveatEmptor.Model.Comment, NHibernateInAction.CaveatEmptor">
    <id name="Id" column="COMMENT_ID">
      <generator class="native" />
    </id>
    <version name="Version" column="VERSION" />
    <property name="Rating" column="RATING" not-null="true" update="false" />
    <property name="Text" column="COMMENT_TEXT" length="4000" />
    <property name="Created" column="CREATED" />
    <many-to-one name="FromUser" column="FROM_USER_ID" not-null="true" outer-join="true" update="false" />
    <many-to-one name="Item" column="ITEM_ID" not-null="true" outer-join="true" update="false" />
  </class>
  <class table="CUSTOMER" name="NHibernateInAction.CaveatEmptor.Model.Customer, NHibernateInAction.CaveatEmptor">
    <id name="Id" column="CUSTOMER_ID">
      <generator class="native" />
    </id>
    <many-to-one name="CustomerLocation" not-null="false" outer-join="true" update="false">
      <column name="CUSTOMER_LOC_ONE" />
      <column name="CUSTOMER_LOC_TWO" />
    </many-to-one>
  </class>
  <class table="CUSTOMER_LOCATION" name="NHibernateInAction.CaveatEmptor.Model.CustomerLocation, NHibernateInAction.CaveatEmptor">
    <composite-id>
      <key-property name="One" column="CUSTOMER_LOCATION_ONE" length="100" />
      <key-property name="Two" column="CUSTOMER_LOCATION_TWO" length="100" />
    </composite-id>
  </class>
  <class lazy="false" table="ITEM" name="NHibernateInAction.CaveatEmptor.Model.Item, NHibernateInAction.CaveatEmptor">
    <id name="Id" column="ITEM_ID">
      <generator class="native" />
    </id>
    <version name="Version" column="VERSION" />
    <property name="Name" column="NAME" length="255" not-null="true" update="false" />
    <property name="Description" column="DESCRIPTION" length="4000" not-null="true" />
    <property name="InitialPrice" type="NHibernateInAction.CaveatEmptor.Persistence.MonetaryAmountCompositeUserType, NHibernateInAction.CaveatEmptor">
      <column name="INITIAL_PRICE" length="2" not-null="true" />
      <column name="INITIAL_PRICE_CURRENCY" not-null="true" />
    </property>
    <property name="ReservePrice" type="NHibernateInAction.CaveatEmptor.Persistence.MonetaryAmountCompositeUserType, NHibernateInAction.CaveatEmptor">
      <column name="RESERVE_PRICE" length="2" not-null="true" />
      <column name="RESERVE_PRICE_CURRENCY" not-null="true" />
    </property>
    <property name="StartDate" column="START_DATE" not-null="true" update="false" />
    <property name="EndDate" column="END_DATE" not-null="true" update="false" />
    <property name="State" column="STATE" not-null="true" />
    <property name="ApprovalDatetime" column="APPROVAL_DATETIME" not-null="false" />
    <property name="Created" column="CREATED" not-null="true" update="false" />
    <many-to-one name="ApprovedBy" column="APPROVED_BY_USER_ID" foreign-key="FK1_APPROVED_BY_USER_ID" />
    <many-to-one name="Seller" column="SELLER_ID" not-null="true" outer-join="false" update="false" />
    <many-to-one name="SuccessfulBid" column="SUCCESSFUL_BID_ID" not-null="false" outer-join="false" />
    <set name="CategorizedItems" lazy="true" inverse="true" cascade="all-delete-orphan">
      <key foreign-key="FK2_CATEGORIZED_ITEM_ID">
        <column name="ITEM_ID" length="16" not-null="true" />
      </key>
      <one-to-many class="NHibernateInAction.CaveatEmptor.Model.CategorizedItem, NHibernateInAction.CaveatEmptor" />
    </set>
    <bag name="Bids" inverse="true" cascade="All" order-by="CREATED desc">
      <key column="ITEM_ID" />
      <one-to-many class="NHibernateInAction.CaveatEmptor.Model.Bid, NHibernateInAction.CaveatEmptor" />
    </bag>
    <query name="maxBid">select b from Bid b where b.Amount.Value = (select max(b.Amount.Value) from Bid b where b.Item.Id = :itemid)</query>
  </class>
  <class table="USERS" name="NHibernateInAction.CaveatEmptor.Model.User, NHibernateInAction.CaveatEmptor">
    <id name="Id" column="USER_ID">
      <generator class="native" />
    </id>
    <version name="Version" column="VERSION" />
    <property name="Firstname" column="FIRST_NAME" not-null="true" />
    <property name="Lastname" column="LAST_NAME" not-null="true" />
    <property name="Username" column="USERNAME" length="16" not-null="true" update="false" />
    <property name="Password" column="`PASSWORD`" not-null="true" />
    <property name="Email" column="EMAIL" not-null="true" />
    <property name="Ranking" column="RANKING" not-null="true" />
    <property name="IsAdmin" column="IS_ADMIN" not-null="true" />
    <property name="Created" column="CREATED" not-null="true" update="false" />
    <many-to-one name="DefaultBillingDetails" column="DEFAULT_BILLING_DETAILS_ID" not-null="false" outer-join="false" foreign-key="FK1_DEFAULT_BILLING_DETAILS_ID" />
    <component name="BillingAddress">
      <property name="City" column="BILLING_CITY" />
      <property name="Street" column="BILLING_STREET" />
      <property name="Zipcode" column="BILLING_ZIP_CODE" />
    </component>
    <component name="HomeAddress" update="false">
      <property name="Street" column="STREET" />
      <property name="Zipcode" column="ZIP_CODE" />
      <property name="City" column="CITY" />
    </component>
    <set name="Items" inverse="true" cascade="None">
      <key>
        <column name="SELLER_ID" not-null="true" />
      </key>
      <one-to-many class="NHibernateInAction.CaveatEmptor.Model.Item, NHibernateInAction.CaveatEmptor" />
    </set>
    <set name="BillingDetails" inverse="true" cascade="all-delete-orphan">
      <key>
        <column name="USER_ID" not-null="true" />
      </key>
      <one-to-many class="NHibernateInAction.CaveatEmptor.Model.BillingDetails, NHibernateInAction.CaveatEmptor" />
    </set>
  </class>
  <joined-subclass table="CREDIT_CARD" extends="NHibernateInAction.CaveatEmptor.Model.BillingDetails, NHibernateInAction.CaveatEmptor" name="NHibernateInAction.CaveatEmptor.Model.CreditCard, NHibernateInAction.CaveatEmptor">
    <key column="CREDIT_CARD_ID" foreign-key="FK1_CREDIT_CARD_ID" />
    <property name="Type" column="CC_TYPE" not-null="true" update="false" />
    <property name="Number" column="CC_NUMBER" length="16" not-null="true" />
    <property name="ExpMonth" column="EXP_MONTH" length="2" not-null="true" update="false" />
    <property name="ExpYear" column="EXP_YEAR" length="4" not-null="true" update="false" />
  </joined-subclass>
  <joined-subclass table="BANK_ACCOUNT" extends="NHibernateInAction.CaveatEmptor.Model.BillingDetails, NHibernateInAction.CaveatEmptor" name="NHibernateInAction.CaveatEmptor.Model.BankAccount, NHibernateInAction.CaveatEmptor">
    <key column="BANK_ACCOUNT_ID" foreign-key="FK1_BANK_ACCOUNT_ID" />
    <property name="Number" column="ACCOUNT_NUMBER" length="16" not-null="true" />
    <property name="BankName" column="BANK_NAME" length="255" not-null="true" />
    <property name="BankSwift" column="BANK_SWIFT" length="15" not-null="true" />
  </joined-subclass>
</hibernate-mapping>